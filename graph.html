<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</title>
    <link rel="stylesheet" href="style.css"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü */
        .chart-container {
            position: relative; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
            height: 550px;
        }
        .instruction {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #888;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px 15px;
            border-radius: 8px;
            pointer-events: none; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡πÑ‡∏î‡πâ */
        }
    </style>
</head>
<body>
    <main>
        <h1>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡πâ‡∏≤‡∏ô</h1>
        <div class="chart-container">
            <p class="instruction">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</p>
            <canvas id="scoreChart"></canvas>
        </div>
        <a href="index.html" class="back-button">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• üìù</a>
    </main>

    <script>
        window.onload = function () {
            const settings = JSON.parse(localStorage.getItem('groupSettings'));
            const allScores = JSON.parse(localStorage.getItem('allScores'));

            if (!settings || !allScores || allScores.length === 0) {
                document.querySelector('main').innerHTML = `
                    <h1>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h1>
                    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡πà‡∏≠‡∏ô</p>
                    <a href="index.html" class="back-button">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>`;
                return;
            }

            const fullLabels = [];
            const fullDatasets = settings.map(s => ({
                label: s.name,
                borderColor: s.color,
                backgroundColor: s.color + '33',
                data: [],
                tension: 0.1,
                fill: false
            }));

            let cumulativeScores = new Array(settings.length).fill(0);
            for (let i = 0; i < allScores.length; i++) {
                fullLabels.push(`‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà ${i}`);
                allScores[i].forEach((score, j) => {
                    cumulativeScores[j] += score || 0;
                    fullDatasets[j].data.push(cumulativeScores[j]);
                });
            }

            const canvas = document.getElementById('scoreChart');
            const ctx = canvas.getContext('2d');
            canvas.style.cursor = 'pointer';

            // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ---
            // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á "‡∏ò‡∏á" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô
            let animationHasStarted = false;

            const myChart = new Chart(ctx, {
                type: 'line',
                data: { // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ (null) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏Ñ‡πà‡πÅ‡∏Å‡∏ô
                    labels: fullLabels,
                    datasets: settings.map(s => ({
                        label: s.name,
                        borderColor: s.color,
                        backgroundColor: s.color + '33',
                        data: new Array(fullLabels.length).fill(null),
                        tension: 0.1,
                        fill: false
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 7000, // ‡∏Ñ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ
                        easing: 'easeInOutSine',
                        onComplete: () => {
                            // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö "‡∏ò‡∏á" ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                            // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å (‡∏ò‡∏á‡πÄ‡∏õ‡πá‡∏ô false) ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢
                            if (animationHasStarted) {
                                animateNextSegment();
                            }
                        }
                    },
                    elements: {
                        line: { borderWidth: 3.5 },
                        point: { radius: 4 }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏™‡∏∞‡∏™‡∏°' }
                        },
                        x: {
                            title: { display: true, text: 'Design By SCiUS KU 14' }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: '‡∏á‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≠‡∏á 2568',
                            font: { size: 18 }
                        },
                        legend: { position: 'top' }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    }
                }
            });

            let currentPoint = -1;
            function animateNextSegment() {
                currentPoint++;
                if (currentPoint >= fullLabels.length) {
                    canvas.style.cursor = 'default';
                    return;
                }
                fullDatasets.forEach((dataset, dsIndex) => {
                    myChart.data.datasets[dsIndex].data[currentPoint] = dataset.data[currentPoint];
                });
                myChart.update();
            }

            // 3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤ "‡∏ò‡∏á" ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô "‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á" ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
            canvas.addEventListener('click', () => {
                document.querySelector('.instruction').style.display = 'none';
                animationHasStarted = true; // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
                animateNextSegment();       // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÅ‡∏£‡∏Å
            }, { once: true }); // ‡πÉ‡∏´‡πâ event ‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
        };
    </script>
</body>
</html>
